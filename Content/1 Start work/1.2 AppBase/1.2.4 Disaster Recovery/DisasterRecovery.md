# АВАРИЙНОЕ ВОССТАНОВЛЕНИЕ

В этом разделе описывается архитектура развертывания **Аварийного восстановления** солюшена.

Солюшены на базе платформы AppBase состоят из следующих компонентов:
1. **Структурированные данные солюшена** - структурированные runtime данные _(например, таблицы базы данных, представления, материализованные представления и т.д.)_, хранящиеся в СУБД Oracle.
1. **Неструктурированные данные солюшена** - неструктурированные runtime данные _(например, документы, двоичные файлы и т.д.)_. Хранятся в системе хранения _(например, файловой системе)_
1. **Конфигурация солюшена и метаданные** - эти данные хранятся в СУБД Oracle и системе хранения. Отдельные схемы, разделы используются для разделения runtime данных и метаданных.
1. **Виртуальные машины приложений AppBase** - виртуальные машины с программным обеспечением AppBase имеют двоичные файлы продукта, конфигурацию продукта и метаданные.
1. **Виртуальные машины инфраструктуры AppBase** - виртуальные машины инфраструктуры AppBase _(сервер сеанса, JMS, серверы отчетов и т.д.)_ используются в рабочих целях, и их состояние всегда можно восстановить из структурированных данных солюшена, данных конфигурации и метаданных.

С точки зрения аварийного восстановления существует четыре типа ресурсов для синхронизации:
* **Содержимое базы данных** - содержимое runtime часто меняется, конфигурация и метаданные редко
* **Хранилище** - содержимое runtime часто меняется, конфигурация и метаданные редко
* **Виртуальные машины AppBase** - меняются редко
* **Компоненты общей инфраструктуры** - предполагается, что они реплицируются между активными и пассивными сайтами.

На рисунке ниже показана топология аварийного восстановления солюшена DCM.

![Disaster Recovery Topology](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/1.2.4%20Disaster%20Recovery/IMG/DisasterRecoveryTopology.png?raw=true)

Некоторые из ключевых аспектов описанного выше:
1. Солюшен имеет 2 сайта. Текущий продакшен сайт работает и активен, в то время как второй сайт работает как резервный и находится в пассивном режиме.
2. Хосты на каждом сайте имеют точки монтирования, определенные для доступа к общей системе хранения для сайта.
3. На обоих сайтах общие данные солюшена хранятся в общей системе хранения сайта. Это включает в себя создание всех необходимых каталогов, которые включают runtime данные солюшена, метаданные солюшена и данные конфигурации, в томах в общем хранилище сайта.
**_NOTE:_** в общем хранилище создаются отдельные тома _(папки)_ для хранения runtime данных солюшена, метаданных солюшена и данных конфигурации, упомянутых выше.
4. Технология репликации хранилища используется для копирования данных из общего хранилища продакшен сайта в общее хранилище резервного сайта.
5. Виртуальные машины приложений и инфраструктуры AppBase содержат только двоичные файлы и конфигурацию продукта и не содержат никаких данных, связанных с конкретным решением. Их можно эффективно синхронизировать с помощью инструментов репликации гипервизора _(например, VMware Replication, Hyper-V Replica и т.д.)_ или с помощью специального стороннего программного обеспечения, относящегося к инфраструктуре поставщика.
6. Oracle Data Guard используется для репликации всех репозиториев баз данных Oracle.
7. Инкрементные репликации планируются через определенные интервалы в зависимости от целей точки восстановления.
8. Пользовательские запросы изначально направляются на продакшен площадку.
9. В случае сбоя или планового отключения продакшен площадки выполняются следующие шаги, чтобы резервная площадка могла взять на себя продакшен роль в топологии:
  * Остановите репликацию с продакшен сайта на резервный _(при сбое репликация могла быть уже остановлена ​​из-за сбоя)_.
  * Выполните аварийное переключение или переключение баз данных Oracle с помощью Oracle Data Guard.
  * Запустите службы и приложения на резервном сайте.
  * Используйте глобальный балансировщик нагрузки, чтобы перенаправить запросы пользователей на резервный сайт. На данный момент
резервный сайт взял на себя роль продакшена.

Предлагаемая архитектура полностью отвечает требованиям аварийного восстановления и обеспечивает достижение цели восстановления, не превышающей 4-х часов.


<br/>

[back to AppBase](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/AppBase.md) | [back to topics](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/tree/main/Content/0%20Topics/Topics.md)