# АРХИТЕКТУРА УСТАНОВКИ APPBASE DCM

На рисунке ниже показана основная схема архитектуры установки AppBase.

![Installation Architecture](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/2.3%20INSTALLATION%20ARCHITECTURE/IMG/InstallationArchitecture.png?raw=true)

На следующей диаграмме показана высокоуровневая архитектура платформы AppBase иллюстрирующая зависимости между уровнями.
между ярусами.

![Dependencies Between Tiers](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/2.3%20INSTALLATION%20ARCHITECTURE/IMG/DependenciesBetweenTiers.png?raw=true)

### УРОВЕНЬ ВЕБ-ПРИЛОЖЕНИЯ APPBASE

<details><summary><i><h7>click to expand!</h7></i></summary>

**ВЕБ уровень AppBase** - представляет узлы, на которых выполняются компоненты веб-приложения AppBase. Эти компоненты доступны для определенных пользователей.
Существует две основные части:
  * **Клиентские компоненты AppBase** _(AppBase Desktop, AppBase Application Studio, Средство просмотра документов AppBase, пакет сканирования документов AppBase, документ WebDAV AppBase)_
  * **Системные веб-службы AppBase**

Службы веб-приложений AppBase реализованы как веб-приложения / веб-службы, размещенные в информационной службе Интернета _(Internet Information Service **IIS**)_.

Большинство этих компонентов не имеют состояния, за исключением **AppBase Desktop**, который хранит состояние сеанса на **сервере сеансов AppBase** _(AppBase Session Server)_. Это дает возможность создать кластер с балансировкой нагрузки, состоящий из узлов, на которых работают службы веб-приложений AppBase. Рекомендуется использовать протокол связи SSL даже для связи внутри интрасети _(TLS v1.2)_. SSL будет выгружен на балансировщик нагрузки, а простые запросы будут передаваться на соответствующие порты служб веб-приложений AppBase.

Уровень служб веб-приложений AppBase взаимодействует с: _уровнем инфраструктуры AppBase, общей инфраструктурой и уровнем данных._

Предлагаемая архитектура позволяет эффективно масштабировать систему по горизонтали за счет добавления новых узлов в кластер с балансировкой нагрузки.

#### Требования к программному и аппаратному обеспечению
Мы сочли целесообразным создать образ виртуальной машины со всеми установленными компонентами, чтобы иметь возможность быстро выводить новые экземпляры в онлайн режим.

Требования к программному обеспечению узла:
| **NAME**                             | **VALUE**                            | **DESCRIPTION** |
|--------------------------------------|--------------------------------------|-----------------|
| OS                                   | Windows Server 2016 Standard x64     |                 |
| .NET Framework                       | 4.7.2                                |                 |
| AppBase Web Application Services     | Installed                            |                 |

Требования к оборудованию узла:
| **COMPONENT** | **REQUIREMENTS**     | **COMMENTS** |
|---------------|----------------------|--------------|
| PROCESSOR     | 4 vCPUs, 2.5 GHz     |              |
| RAM           | 16 GB RAM            |              |
| HDD           | 256 GB               |              |

Некоторые из ключевых аспектов конфигурации узла:
1. Узел должен иметь точки монтирования, определенные для доступа к общей системе хранения для сайта.
2. Общие данные хранятся в общей системе хранения сайта. Это включает в себя создание всех необходимых каталогов, включая runtime данные, метаданные и данные конфигурации, в томах в общем хранилище сайта.

**_NOTE:_** _В общем хранилище создаются отдельные тома (папки) для хранения runtime данных, метаданных и данных конфигурации, упомянутых выше._

</details>

### УРОВЕНЬ СЛУЖБ СИСТЕМНОГО ПРИЛОЖЕНИЯ APPBASE

<details><summary><i><h7>click to expand!</h7></i></summary>

Уровень служб системных приложений AppBase - представляет узлы, на которых запущены службы системных приложений AppBase, обрабатывающие фоновые процессы, запланированные события, очереди и т.д.

В отличие от [системных служб веб-приложений AppBase](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/2.3%20INSTALLATION%20ARCHITECTURE/InstallationArchitecture.md#%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8C-%D0%B2%D0%B5%D0%B1-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-appbase), которые предназначены для обслуживания краткосрочных запросов, службы системных приложений AppBase используются для выполнения длительных процессов и реализованы как службы Windows.

Уровень служб приложений системы AppBase взаимодействует с: _уровнем приложений AppBase (AppBase System Web Services), уровнем инфраструктуры AppBase, общей инфраструктурой и уровнем данных._

Службы системных приложений AppBase используют уровень данных (база данных) и уровень инфраструктуры AppBase. (AppBase JMS) для выполнения задач.

Предлагаемая архитектура позволяет эффективно масштабировать систему по горизонтали за счет добавления новых узлов в кластер с балансировкой нагрузки.

#### Требования к программному и аппаратному обеспечению
Мы сочли целесообразным создать образ виртуальной машины со всеми установленными компонентами, чтобы иметь возможность быстро выводить новые экземпляры в онлайн режим.

Требования к программному обеспечению узла:
| **NAME**                             | **VALUE**                            | **DESCRIPTION** |
|--------------------------------------|--------------------------------------|-----------------|
| OS                                   | Windows Server 2016 Standard x64     |                 |
| .NET Framework                       | 4.7.2                                |                 |
| AppBase System Application Services  | Installed                            |                 |

Требования к оборудованию узла:
| **COMPONENT** | **REQUIREMENTS**     | **COMMENTS** |
|---------------|----------------------|--------------|
| PROCESSOR     | 4 vCPUs, 2.5 GHz     |              |
| RAM           | 16 GB RAM            |              |
| HDD           | 256 GB               |              |

Некоторые из ключевых аспектов конфигурации узла:
1. Узел должен иметь точки монтирования, определенные для доступа к общей системе хранения для сайта.
2. Общие данные хранятся в общей системе хранения сайта. Это включает в себя создание всех необходимых каталогов, включая runtime данные, метаданные и данные конфигурации, в томах в общем хранилище сайта.

**_NOTE:_** _В общем хранилище создаются отдельные тома (папки) для хранения runtime данных, метаданных и данных конфигурации, упомянутых выше._

</details>

### УРОВЕНЬ ИНФРАСТРУКТУРЫ APPBASE

<details><summary><i><h7>click to expand!</h7></i></summary>

**Уровень инфраструктуры AppBase** состоит из следующих компонентов _(см. ниже)_. Каждый компонент настроен для удовлетворения требований высокой доступности и отказоустойчивости. Мы рекомендуем использовать ОС **Linux / Unix** для размещения этих компонентов.

#### JMS cервер AppBase
AppBase использует **JMS** в качестве служебной шины для управления фоновыми событиями, запланированными событиями, очередями и т.д. Сервис AppBase JMS построен с использованием **Apache Active MQ**.
| **NAME**                 | **DESCRIPTION**                                |
|--------------------------|------------------------------------------------|
| Software                 | [Apache Active MQ](http://activemq.apache.org) |
| Version                  | 5.10.x or newer                                |
| Connection Configuration | Failover transport connection, maxReconnectAttempt, maxReconnectDelay,
etc parameters are fine-tuned based on the system scale                     |
| Number of nodes          | >=2                                            |
| Message Persistence      | Replicated Message Store (use file based persistence mechanisms, rely on
Shared Storage Store to ensure HA)                                          |

#### Сессионный сервер AppBase
AppBase использует **Redis** для хранения состояния сеанса для уровня веб-приложений AppBase.
| **NAME**                 | **DESCRIPTION**               |
|--------------------------|-------------------------------|
| Software                 | [Redis](https://redis.io/)    |
| Version                  | 3.2.x or newer                |
| Connection Configuration | Failover transport connection |
| Number of nodes          | >=2                           |


#### Клиент отчетов AppBase
Клиент отчетов AppBase - это специализированное приложение для рендеринга **отчетов Jasper** _(это дефолтная технология для отчетов AppBase)_. Он реализован как отдельное веб-приложение Java и может быть размещен на любом сервере **J2EE**, _например Apache Tomcat_. Клиент отчетов AppBase не имеет состояния и может эффективно масштабироваться по горизонтали.
| **NAME**                 | **DESCRIPTION**                            |
|--------------------------|--------------------------------------------|
| Software                 | [Apache Tomcat](http://tomcat.apache.org/) |
| Version                  | 8.x or newer                              |
| Number of nodes          | >=2                                        |


#### Полнотекстовый поиск в AppBase
Сервер полнотекстового поиска AppBase используется для индексации неструктурированных и структурированных данных. Он построен на базе **Apache Solr Cloud**. Полнотекстовый поиск AppBase не имеет состояния и может эффективно масштабироваться по горизонтали.
| **NAME**                 | **DESCRIPTION**                                     |
|--------------------------|-----------------------------------------------------|
| Software                 | [Apache Solr](http://lucene.apache.org/solr/)       |
| Version                  | 6.x or newer                                        |
| Configuration            | Failover configuration with Zookeeper               |
| Number of nodes          | >=3 (minimum number of nodes in Zookeeper ensemble) |

1170 / 5000
Результаты перевода
На следующей схеме показано взаимодействие между веб-сервером AppBase и серверами приложений, а также уровнем инфраструктуры AppBase.

![Communication](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/2.3%20INSTALLATION%20ARCHITECTURE/IMG/DependenciesBetweenTiers.png?raw=true)

Как следует из диаграммы, AppBase JMS _(построенная на основе [Apache Active MQ](http://activemq.apache.org))_ и AppBase Session _(построенная на основе [Redis.io](https://redis.io/))_ используют свои собственные механизмы для обеспечения высокой доступности и отказоустойчивости, в то время как JMS по-прежнему использует реплицированное хранилище сообщений. расположен в хранилище общего хранилища. Серверы сеансов AppBase JMS и AppBase можно масштабировать по горизонтали, добавляя новые узлы без изменения топологии других компонентов.

Клиент отчетов AppBase и полнотекстовый поиск AppBase - это веб-приложения. Два кластера _(первый для клиента отчетов AppBase и второй для полнотекстового поиска AppBase)_ могут быть созданы и сбалансированы по нагрузке.

Рекомендуется использовать протокол связи SSL _(TLS v1.2)_. SSL будет выгружен на балансировщик нагрузки, а простые запросы будут передаваться на соответствующие порты приложений.

Клиент отчетов AppBase и полнотекстовый поиск AppBase можно масштабировать по горизонтали с помощью добавление новых узлов в кластер и обновление конфигурации балансировщика нагрузки без изменения топологии других компонентов.

#### Требования к программному и аппаратному обеспечению
Мы сочли целесообразным создать образ виртуальной машины со всеми установленными компонентами, чтобы иметь возможность быстро выводить новые экземпляры в онлайн режим.

Требования к программному обеспечению узла:
| **NAME**             | **VALUE**                            | **DESCRIPTION** |
|----------------------|--------------------------------------|-----------------|
| OS                   | RedHat Linux 7.0 Enterprise or newer |                 |
| JDK                  | 8.xx or newer                        |                 |
| Apache ActiveMQ      | 5.10.x or newer                      |                 |
| Apache Tomcat Server | 8.x or newer                         |                 |
| Apache Solr Cloud    | 7.x or newer                         |                 |
| Redis.IO             | 3.2.x or newer                       |                 |

Требования к оборудованию узла:
| **COMPONENT** | **REQUIREMENTS**     | **COMMENTS** |
|---------------|----------------------|--------------|
| PROCESSOR     | 4 vCPUs, 2.5 GHz     |              |
| RAM           | 16 GB RAM            |              |
| HDD           | 256 GB               |              |

Некоторые из ключевых аспектов конфигурации узла:
1. Узел должен иметь точки монтирования, определенные для доступа к общей системе хранения для сайта.
2. Общие данные хранятся в общей системе хранения сайта. Это включает в себя создание всех необходимых каталогов, включая runtime данные, метаданные и данные конфигурации, в томах в общем хранилище сайта.

**_NOTE:_** _В общем хранилище создаются отдельные тома (папки) для хранения runtime данных, метаданных и данных конфигурации, упомянутых выше._

</details>

### ЛОГИРОВАНИЕ И АУДИТ УСТАНОВКИ APPBASE

<details><summary><i><h7>click to expand!</h7></i></summary>

Платформа логирования и аудита установки AppBase предоставляет консолидированную систему, которая записывает и сохраняет информацию журнала аудита от всех базовых компонентов/уровней, включая:
* Логи событий бизнес-уровня Решения DCM _(например, создание дела, создание задачи, задача переназначения, загрузка документа и т.д.)_.
* Логи платформы AppBase, включая уровнень веб-приложение AppBase и уровнень служб системного приложения AppBase.
Сюда входят логи всех компонентов AppBase, включая службу безопасности, Служба рабочих процессов, служба бизнес-данных, службы управления контентом и т.д.
* Логи уровня инфраструктуры AppBase
* Логи уровня общей инфраструктуры и уровня данных
* Логи сетевых взаимодействий, событий ВМ _(виртуальной машины)_ и т.д.

Все охваченные компоненты предоставят нормализованные данные, достаточные для ответа на следующие вопросы:
* Какая активность выполнялась?
* Кто или что выполняло активность, в том числе откуда или из какой системы эта активность была выполнена?
* Какие активность выполнялись в системе?
* Когда было выполнена активность?
* С помощью какой программы была выполнена активность?
* Какой был статус _(например, успех или неудача)_, результат или результат активность?

#### Конфигурация аудита / логирования
Логи будут создаваться всякий раз, когда система запрашивает выполнение любого из следующих действий:
* Создание, чтение, обновление или удаление конфиденциальной информации о солюшене DCM _(в соответствии с требованиями)_
* Создание, чтение, обновление или удаление конфигурации и метаинформации солюшена AppBase
* Инициируйте сетевое соединение
* Прининмаете сетевое соединение
* Аутентификация и авторизация пользователей _(вход в систему и выход из системы)_
* Предоставление, изменение или отзыв прав доступа _(например, добавление нового пользователя/группы, изменение уровней привилегий пользователей, изменение прав доступа к файлам, изменение прав доступа к объектам базы данных, изменение правил брандмауэра и изменение пароля пользователя)_
* Изменения конфигурации системы, сети или службы _(например, установка патчей и обновлений программного обеспечения, или другие изменения установленного программного обеспечения)_
* Запуск, завершение работы или перезапуск процесса приложения
* Прерывание, сбой или аварийное завершение процесса приложения, особенно из-за исчерпания ресурсов или достижения предела, или порогового значения ресурсов _(например, для ЦП, памяти, сетевых подключений, пропускная способность сети, дисковое пространство или другие ресурсы)_, сбой сетевых служб, таких как DHCP или DNS, или сбой оборудования
* Обнаружение подозрительной/вредоносной активности, например, со стороны системы предотвращения вторжений (IPS), антивирусной системы или других систем безопасности.

#### Элементы логов
Для каждой записи лога будет доступна следующая информация:
* Тип активности - примеры включают авторизацию, создание, чтение, обновление, удаление и принятие сетевого подключения.
* Подсистемы, выполняющие действие - примеры включают имя процесса или транзакции, процесс или идентификатор транзакции.
* Идентификаторы _(столько, сколько доступно)_ для субъекта, запрашивающего действие - примеры включают имя пользователя, имя компьютера, IP-адрес и MAC-адрес.
**_NOTE: _** такие идентификаторы должны быть стандартизированы, чтобы облегчить корреляцию логов.
* Идентификаторы _(столько, сколько доступно)_ для объекта, над которым было выполнено действие - примеры включают имена файлов, к которым был получен доступ, уникальные идентификаторы записей, к которым осуществляется доступ в базе данных, параметры запроса, используемые для определения записей, к которым осуществляется доступ в базе данных, имя компьютера, IP-адрес и MAC адрес.
**_NOTE: _** такие идентификаторы должны быть стандартизированы, чтобы облегчить корреляцию логов.
* Значения до и после, когда действие включает обновление элемента данных, если это возможно.
* Дата и время выполнения активности, включая соответствующую информацию о часовом поясе, если не указано иное.
**_NOTE: _**  Мировое время. Эта дата и время должны быть синхронизированы с использованием серверов NTP хоста.
* Была ли разрешена или запрещена активность механизмами контроля доступа.
* Описание и/или коды причин, почему активность была отклонена механизмом контроля доступа, если применимо.

#### Хранение логов
Система будет поддерживать форматирование и хранение логов аудита таким образом, чтобы обеспечивать их целостность и поддерживать анализ и отчетность на интерпрайз уровне _(enterprise-level)_. Все журналы аудита должны храниться в течение одного года, при этом три месяца должны быть доступны онлайн.

Ключевые аспекты системы аудита/логирования:
* Система управления логами на интерпрайз уровне используется для хранения информации аудита/логов, поступающей из нескольких компонентов, обеспечения отчетности и анализа.
* Логи в хорошо документированном формате отправляются через **Syslog**, **Syslog-ng** или надежные **сетевые протоколы Syslog** в централизованную систему управления логами.

</details>

### УРОВЕНЬ ВЕБ-ПРИЛОЖЕНИЯ APPBASE

<details><summary><i><h7>click to expand!</h7></i></summary>

+++

</details>


<br/>

[back to AppBase](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20AppBase/AppBase.md) | [back to topics](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/tree/main/Content/0%20Topics/Topics.md)