# Controller

  Controllers - это клей, который связывает приложение. Тем не менее, их основная цель - отслеживать события (обычно из View) и предпринимать какие-либо действия. Вот как мы можем создать Controller для управления пользователями:
  ```JavaScript
  Ext.define('MyApp.controller.Users', {
      extend: 'Ext.app.Controller',

      init: function() {
          console.log('Initialized Users! This happens before ' +
                      'the Application launch() function is called');
      }
  });
  ```

  Функция **`init`** - это специальный метод, который вызывается при загрузке вашего приложения. Он вызывается перед выполнением функции запуска `Ext.app.Application`. Это создает область, в которой можно запустить код до создания области просмотра.

  Функция **`cfg-control`** контроллера упрощает прослушивание событий в ваших классах представления и выполнение некоторых действий с помощью функции-обработчика. Обновим наш контроллер Users, чтобы он сообщал нам, когда панель отображается:
  ```JavaScript
  Ext.define('MyApp.controller.Users', {
      extend: 'Ext.app.Controller',

      control: {
          'viewport > panel': {
              render: 'onPanelRendered'
          }
      }

      onPanelRendered: function() {
          console.log('The panel was rendered');
      }
  });
  ```

  Метод управления теперь настроил слушателей для представлений в нашем приложении. Метод управления использует механизм **ComponentQuery**, чтобы быстро и легко получить ссылки на компоненты на странице. Вкратце, он позволяет нам передать CSS-подобный селектор, который найдет все подходящие компоненты на странице.

  В функции инициализации выше мы предоставили **`viewport> panel`**, что переводится как "найди мне каждую панель, которая является прямым потомком **Viewport**". Затем мы предоставили объект, который сопоставляет имена событий _(в данном случае просто рендеринг)_ функциям-обработчикам. Короче говоря, всякий раз, когда компонент, соответствующий нашему селектору, запускает событие _`render`_, вызывается наша функция `onPanelRendered`.

### Домены событий

  В Ext JS 4.2 введено понятие доменов событий. С точки зрения MVC, домен событий - это один или несколько базовых классов, которые запускают события, которые **Controller** хочет прослушивать. Помимо домена событий **Component**, который охватывает представления, спускаемые по **`Ext.Component`**, контроллеры теперь могут прослушивать события из хранилищ данных, поставщиков `Ext.Direct`, других контроллеров и `Ext.GlobalEvents`. Эта функция обеспечивает способ связи между частями всего приложения без необходимости плотно связывать контроллеры вместе, а также позволяет разрабатывать и тестировать части приложения изолированно.

### Использование ссылок

  Одна из самых полезных частей контроллеров - это система ссылок **_(references)_**. Они используют `Ext.ComponentQuery`, чтобы упростить получение ссылок на представления на вашей странице. Пример:
  ```JavaScript
  Ext.define('MyApp.controller.Users', {
      extend: 'Ext.app.Controller',

      refs: [{
          ref: 'list',
          selector: 'grid'
      }],

      control: {
          'button': {
              click: 'refreshGrid'
          }
      },

      refreshGrid: function() {
          this.getList().store.load();
      }
  });
  ```

  В этом примере предполагается наличие **Ext.grid.Panel** на странице, которая содержит одну кнопку для обновления сетки при нажатии. В массиве **refs** мы устанавливаем ссылку на сетку. Он состоит из двух частей - **`selector`**, который представляет собой селектор **Ext.ComponentQuery**, который находит любую сетку на странице и назначает ее **reference** `list`.

  Дав ссылке имя, мы получаем ряд вещей. Первая - это функция **`getList`**, которую используем в методе `refreshGrid` выше. Он генерируется автоматически Контроллером на основе имени нашей ссылки, которое было написано с заглавной буквы и добавлено к началу get для перехода от `list` к `getList`.

  Это работает так, что при первом вызове **getList** вашим кодом запускается селектор **ComponentQuery** и возвращается первый компонент, соответствующий селектору _(в данном случае **_GRID_**)_. Все будущие вызовы **getList** будут использовать кешированную ссылку на эту сетку. Обычно рекомендуется использовать определенный селектор **ComponentQuery**, который будет соответствовать только одному представлению в вашем приложении _(в приведенном выше случае наш селектор будет соответствовать любой сетке на странице)_.

  Собрав все это вместе, мы настраиваем элемент управления для прослушивания любого щелчка по **Ext.button.Button** и вызываем нашу функцию **refreshGrid** _(опять же, это будет соответствовать любой кнопке на странице, поэтому лучше использовать более конкретный селектор, чем просто "_BUTTON_", в примере делали так для простоты)_. Когда кнопка нажата, мы используем функцию **getList** для обновления грида.

  Вы можете создавать любое количество ссылок и управлять любым количеством компонентов таким образом, просто добавляя больше функций в свой Контроллер по мере продвижения.

### Getter методы
  Ссылки _(references)_ - не единственное, что генерирует удобные getter методы. Контроллерам часто приходится иметь дело с **Models** и **Stores**, поэтому фреймворк также предлагает несколько простых способов получить к ним доступ. Посмотрим пример:
  ```JavaScript
  Ext.define('MyApp.controller.Users', {
      extend: 'Ext.app.Controller',

      models: ['User'],
      stores: ['AllUsers', 'AdminUsers'],

      init: function() {
          var User, allUsers, ed;

          User = this.getUserModel();
          allUsers = this.getAllUsersStore();

          ed = new User({ name: 'Ed' });
          allUsers.add(ed);
      }
  });
  ```

  Указывая **Models** и **Stores**, о которых заботится Контроллер, он снова динамически загружает их из соответствующих мест _(app / model / User.js, app / store / AllUsers.js и app / store / AdminUsers.js в этом случае)_ и создает getter функции для них всех. В приведенном выше примере будет создан новый экземпляр модели User и добавлен в AllUsers Store. Конечно, в этой функции можно делать что угодно, но в данном случае сделано что-то простое, чтобы продемонстрировать функциональность.


<br/>

_Более подробно с **Ext.app.Controller** можно ознакомиться на [официальном сайте](https://docs.sencha.com/extjs/5.1.1/api/Ext.app.Controller.html)._


<br/>

[back to Architecture](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.1%20ExtJS/1.1.1%20Architecture/Architecture.md) | [back to ExtJS](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.1%20ExtJS/ExtJS.md) | [back to topics](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/tree/main/Content/0%20Topics/Topics.md)