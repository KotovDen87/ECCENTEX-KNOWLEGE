# Процесс загрузки

  Каждый день _(В 07:15 загружаются DWH, в 22:00 - 1С)_ производится загрузка данных о клиентах банка. За каждый из запусков отвечает соответствующий таск, созданный в **`Task Scheduler`**

  ![img1](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20Load%20from%20CSV/IMG/1.png?raw=true)

  Оба таска созданы под обычной учеткой, предоставленной каждому из нас. **_НО_**  сами таски работают/запускаются именно под **системной учеткой**.

  Порядок загрузки:

1. В заданное время срабатывает тригер таска, который запускает **PowerShell скрипт**.
2. **PowerShell скрипт** отбирает соответствующий архив с данными, распаковывает его в папку **`toLoad`**, производит загрузку данных в наши **_TMP таблицы_**.     Загрузка производится путем вызова SQL*Loader внутри скрипта. После загрузки файл из **`toLoad`** перемещается в папку **`processed`**
3. После чего **PowerShell скрипт** запускает **`SQL*Plus`**, вызывающий нашу процедуру загрузки.
4. Данная процедура отбирает записи из **_TMP таблиц_** и производит **INSERT/UPDATE** **_Eccentex таблиц_**
5. После того как пункт 4 завершен, **PowerShell скрипт** отключается от БД ORACLE и очищает папку **`ToLoad`** от оставшихся файлов, если таковые имеются.

**_NOTE:_** _Логи загрузки хранятся в папке с одноименным названием **`log`**_