# Процесс загрузки

  Каждый день _(В 07:15 загружаются DWH, в 22:00 - 1С)_ производится загрузка данных о клиентах банка. За каждый из запусков отвечает соответствующий таск, созданный в **`Task Scheduler`**

  ![img1](https://github.com/CrappyCodeMaker/ECCENTEX-KNOWLEGE/blob/main/Content/1%20Start%20work/1.2%20Load%20from%20CSV/IMG/1.png?raw=true)

  Оба таска созданы под обычной моей учеткой, **_НО_**  работают/запускаются из под системной учеткой: **`EXPOMAIN\svc-ecc-CFTtoECC`**.

#### Порядок загрузки:

1. В заданное время срабатывает тригер таска, который запускает **PowerShell скрипт**.
2. **PowerShell скрипт** отбирает соответствующий архив с данными, распаковывает его в папку **`toLoad`**, производит загрузку данных в наши **_TMP таблицы_** путем вызова **`SQL*Loader`**.
3. После того, как данные из файла были загружены в соответствующую таблицу, файл из **`toLoad`** перемещается в папку **`processed`**
4. После загрузки всех файлов **PowerShell скрипт** запускает **`SQL*Plus`**, вызывающий нашу процедуру загрузки.
5. Процедура отбирает записи из **_TMP таблиц_** и производит **INSERT/UPDATE** записи в **_Eccentex таблицу_**
6. После того как пункт 4 завершен, **PowerShell скрипт** отключается от БД ORACLE и очищает папку **`ToLoad`** от оставшихся файлов, если таковые имеются.

**_NOTE:_** _Логи загрузки хранятся в папке с одноименным названием **`log`**_